---
title: "网卡"
date: "2023-01-01 11:01:00"
lastmod: "2023-04-12 10:42:03"
tags: ["network"]
categories: ["Hardware"]
draft: false
---

## 网络信号接入 {#网络信号接入}

1.  RJ-45 接口
    1.  （网线接入）
2.  Transformer
    -   隔离变压器，它的作用是隔离保护，使网线和 PHY 之间没有物理上的连接而换传递了信号。
    -   如果外部网线直接和芯片相连的话,电磁感应(打雷)和静电,很容易造成芯片的损坏。
    -   从信号输出方向看，它把 PHY 送出来的差分信号用差模耦合的线圈耦合滤波以增强信号,并且通过电磁场的转换耦合到连接网线的另外一端。
    -   隔离变压器本身是个被动元件,只是把 PHY 的信号耦合了到网线上，并没有起到功率放大的作用。)
3.  PHY 芯片
    -   物理接口收发器，可以发送和接收以太网的 数据帧 frame，PHY 整合了大量模拟硬件）
4.  MAC 芯片
    -   媒体访问控制子层协议，主要负责控制与连接物理层的物理介质.
    -   其一端接 PHY 芯片，另外一端接到计算机 PCI 总线上,它们之间是通过 MII 接口链接，是典型的 **全数字器件**


## PHY(Physical Layer) {#phy--physical-layer}

硬件上，一般 PHY 芯片为模数混合电路，负责接收电、光这类模拟信号，经过解调和 A/D 转换后通过 MII 接口将信号交给 MAC 芯片进行处理。

物理层定义了数据传送与接收所需要的电与光信号、线路状态、时钟基准、数据编码和电路等，并向数据链路层设备提供标准接口。物理层的芯片称之为 PHY。


## MAC {#mac}

该协议位于 OSI 七层协议中数据链路层的下半部分,主要负责控制与连接物理层的物理介质.

在发送数据的时候,MAC 协议可以事先判断是否可以发送数据,如果可以发送将给数据加上一些控制信息,最终将数据以及控制信息以规定的格式发送到物理层;

在接收数据的时候,MAC 协议首先判断输入的信息并是否发生传输错误,如果没有错误,则去掉控制信息发送至 LLC 层.

MAC 从 PCI 总线收到 IP 数据包(或者其他网络层协议的数据包)后,将之拆分并重新打包成最大 1518Byte,最小 64Byte 的帧.这个帧里面包括了目标 MAC 地址、自己的源 MAC 地址和数据包里面的协议类型(比如 IP 数据包的类型用 80 表示).


## ARP 协议 {#arp-协议}

第一次传送某个目的 IP 地址的数据的时候,先会发出一个 ARP 包,其 MAC 的目标地址是广播地址(”谁是 xxx.xxx.xxx.xxx 这个 IP 地址的主人？). 收到请求的主机将这个 IP 地址和自己的相比较,如果不相同就不予理会,如果相同就发出 ARP 响应包.这个包里面就包括了他的 MAC 地址.以后的给这个 IP 地址的帧的目标 MAC 地址就被确定了.

IP 地址和 MAC 地址之间的关联关系保存在主机系统里面,叫做 ARP 表


## MII（Media Independant Interface) {#mii-media-independant-interface}

即媒体独立接口, MAC 芯片和 PHY 芯片之间的 MII 传输接口. 在不对 MAC 硬件重新设计或替换的情况下,任何类型的 PHY 设备都可以正常工作.

-   包括一个数据接口；
-   以及一个 MAC 和 PHY 之间的管理接口。
-   支持 10Mbps 和 100Mbps 的操作。


## RMII(Reduced Media Independant Interface，简化媒体独立接口) {#rmii--reduced-media-independant-interface-简化媒体独立接口}

1.  RMII 是简化的 MII 接口,在数据的收发上它比 MII 接口少了一倍的信号线。
    -   和 MII 一样,RMII 支持 10Mbps 和 100Mbps 的总线接口速度.
2.  SMII 是由思科提出的一种媒体接口,它有比 RMII 更少的信号线数目,S 表示串行的意思.
3.  GMII(Gigabit MII)是千兆网的 MII 接口。
    -   采用 8 位接口数据,传输速率可达 1000Mbps.同时兼容 MII 所规定的 10/100 Mbps 工作方式.
4.  RGMII 接口,表示简化了的 GMII 接口。


## offload {#offload}

早先 TCP 设计的目标是为了解决低速网络传输的不可靠性问题（拨号上网的年代），但随着互联网骨干传输速度的提升（光纤、千兆以太、万兆以太）以及用户端更可靠的访问机制的出现（ADSL 等），相关的数据中心及客户端桌面环境上的 TCP 软件常常需要面临大量的计算需求。

当网络速度超过 1Gb 的时候，这些计算会耗费大量的 CPU 时间，有数据表明，即便使用千兆全双工网卡，TCP 通信也将消耗 CPU 的 80%的使用率（以 2.4GHz 奔腾 4 处理器为例），这样留给其他应用程序的时间就很少了，表现出来就是用户可能感觉到很慢。

为了解决性能问题，就产生了 TOE 技术（TCP offload engine），将 TCP 连接过程中的相关计算工作转移到专用硬件上（比如网卡），从而释放 CPU 资源。从 2012 年开始，这项技术开始在普通用户的网卡上应用。

随 着技术的日趋成熟，目前越来越多的网卡设备开始支持 offload 特性，以便提升网络收发和处理的性能。

offload 特性，主要是指将原本 在协议栈中进行的 IP 分片、TCP 分段、重组、checksum 校验等操作，转移到网卡硬件中进行，降低系统 CPU 的消耗，提高处理性能。